---
title: 2018-7-18stm32进一步学习
tags: 梁子20163933
grammar_cjkRuby: true
---
# stm32 学习笔记 二

## 串口

MCU：微控制单元，可以指单片机。
miniSTM32开发板：一个USB串口，一个RS232串口。

### 串口设置的基本步骤：
1. 串口时钟使能，GPIO使能
```csharp?linenums
 RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1);
```
2.  串口复位
该函数用于初始的函数配置时，也可以用于外设异常时，其函数为：
```csharp?linenums
void USART_DeInit(USART_TypeDef* USARTx);
```
3. GPIO端口模式设置
这一部分在上一个笔记中已经有记录了。
4. 串口参数初始化
```csharp?linenums
void USART_Init(USART_TypeDef* USARTx, USART_InitTypeDef* USART_InitStruct);
```
与在GPIO中的IO口初始化相似，这里的初始化模块也是被定义的，命名规则也一样。现在把他给出：
```c
typedef struct    //最常用  1停止位 无奇偶校验位 8位字长传输
{
//串口的波特率
  uint32_t USART_BaudRate;            /*!< This member configures the USART communication baud rate.
                                           The baud rate is computed using the following formula:
                                            - IntegerDivider = ((PCLKx) / (16 * (USART_InitStruct->USART_BaudRate)))
                                            - FractionalDivider = ((IntegerDivider - ((u32) IntegerDivider)) * 16) + 0.5 */
//串口的字长，8位  
  uint16_t USART_WordLength;          /*!< Specifies the number of data bits transmitted or received in a frame.
                                           This parameter can be a value of @ref USART_Word_Length */
//停止位，告诉串口有几个停止位
  uint16_t USART_StopBits;            /*!< Specifies the number of stop bits transmitted.
                                           This parameter can be a value of @ref USART_Stop_Bits */
//是否进行奇偶校验
  uint16_t USART_Parity;              /*!< Specifies the parity mode.
                                           This parameter can be a value of @ref USART_Parity
                                           @note When parity is enabled, the computed parity is inserted
                                                 at the MSB position of the transmitted data (9th bit when
                                                 the word length is set to 9 data bits; 8th bit when the
                                                 word length is set to 8 data bits). */
 //串口模式(收，发)
  uint16_t USART_Mode;                /*!< Specifies wether the Receive or Transmit mode is enabled or disabled.
                                           This parameter can be a value of @ref USART_Mode */
//是否进行硬件流控制
  uint16_t USART_HardwareFlowControl; /*!< Specifies wether the hardware flow control mode is enabled
                                           or disabled.
                                           This parameter can be a value of @ref USART_Hardware_Flow_Control */
} USART_InitTypeDef;
```
下面给出上面的这些属性对应的一些宏定义：

>关于wordlength：
```c
#define USART_WordLength_8b                  ((uint16_t)0x0000)
#define USART_WordLength_9b                  ((uint16_t)0x1000)
```
可以看出只有8b和9b两个选项。
>关于数据的发送与接收：
>通过数据寄存器USART_DR来实现，这是一个双寄存器，包括TDR（发送的）与RDR（负责接收的）
>当向寄存器写数据时窗口会自动发送，收到数据时也会储存在该寄存器内。

下面是收发数据的库函数：
```csharp?linenums
void USART_SendData(USART_TypeDef* USARTx, uint16_t Data);//发送数据的函数
uint16_t USART_ReceiveData(USART_TypeDef* USARTx);//发送数据的函数
```




5. 开启中断 并且初始化NVIC

6. 使能串口

7. 编写中断处理函数

> 串口基本配置相关的固件库函数位于usart中











